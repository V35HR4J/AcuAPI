#!/bin/bash

# AcuAPI - Acunetix CLI Tool
# A command-line interface for Acunetix vulnerability scanner

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CONFIG_FILE="${SCRIPT_DIR}/config.json"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Load configuration
load_config() {
    if [[ ! -f "$CONFIG_FILE" ]]; then
        echo -e "${RED}Error: Config file not found at $CONFIG_FILE${NC}"
        exit 1
    fi
    
    API_URL=$(jq -r '.url' "$CONFIG_FILE")
    API_KEY=$(jq -r '.api_key' "$CONFIG_FILE")
    
    if [[ -z "$API_URL" || -z "$API_KEY" ]]; then
        echo -e "${RED}Error: Invalid configuration${NC}"
        exit 1
    fi
}

# API request helper
api_request() {
    local method="$1"
    local endpoint="$2"
    local data="$3"
    
    local url="${API_URL}/api/v1${endpoint}"
    
    local curl_opts=(
        -s
        -k
        -X "$method"
        -H "X-Auth: $API_KEY"
        -H "Content-Type: application/json"
    )
    
    if [[ -n "$data" ]]; then
        curl_opts+=(-d "$data")
    fi
    
    curl "${curl_opts[@]}" "$url"
}

# Print formatted header
print_header() {
    echo -e "\n${CYAN}╔════════════════════════════════════════════╗${NC}"
    echo -e "${CYAN}║${NC}  ${BLUE}$1${NC}"
    echo -e "${CYAN}╚════════════════════════════════════════════╝${NC}\n"
}

# ============== TARGETS ==============

# List all targets
targets_list() {
    print_header "Targets List"
    
    local response=$(api_request GET "/targets")
    
    if echo "$response" | jq -e '.targets' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            .targets[] | 
            "ID: \(.target_id)\nAddress: \(.address)\nDescription: \(.description // "N/A")\nCriticality: \(.criticality // "N/A")\n---"
        '
        
        local count=$(echo "$response" | jq '.targets | length')
        echo -e "\n${GREEN}Total targets: $count${NC}"
    else
        echo -e "${RED}Error fetching targets${NC}"
        echo "$response" | jq . 2>/dev/null || echo "$response"
    fi
}

# Add a new target
targets_add() {
    local address="$1"
    local description="${2:-}"
    local criticality="${3:-10}"
    
    if [[ -z "$address" ]]; then
        echo -e "${RED}Error: Target address is required${NC}"
        echo "Usage: acunetix targets add <url> [description] [criticality]"
        exit 1
    fi
    
    print_header "Adding Target"
    
    local data=$(jq -n \
        --arg addr "$address" \
        --arg desc "$description" \
        --argjson crit "$criticality" \
        '{address: $addr, description: $desc, criticality: $crit}')
    
    local response=$(api_request POST "/targets" "$data")
    
    if echo "$response" | jq -e '.target_id' > /dev/null 2>&1; then
        local target_id=$(echo "$response" | jq -r '.target_id')
        echo -e "${GREEN}✓ Target added successfully!${NC}"
        echo -e "Target ID: ${YELLOW}$target_id${NC}"
        echo -e "Address: $address"
    else
        echo -e "${RED}Error adding target${NC}"
        echo "$response" | jq . 2>/dev/null || echo "$response"
    fi
}

# Get target info
targets_info() {
    local target_id="$1"
    
    if [[ -z "$target_id" ]]; then
        echo -e "${RED}Error: Target ID is required${NC}"
        exit 1
    fi
    
    print_header "Target Information"
    
    local response=$(api_request GET "/targets/$target_id")
    echo "$response" | jq .
}

# Delete a target
targets_delete() {
    local target_id="$1"
    
    if [[ -z "$target_id" ]]; then
        echo -e "${RED}Error: Target ID is required${NC}"
        exit 1
    fi
    
    print_header "Deleting Target"
    
    api_request DELETE "/targets/$target_id"
    echo -e "${GREEN}✓ Target deleted successfully!${NC}"
}

# ============== SCANS ==============

# List all scans
scans_list() {
    print_header "Scans List"
    
    local response=$(api_request GET "/scans")
    
    if echo "$response" | jq -e '.scans' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            .scans[] | 
            "Scan ID: \(.scan_id)\nTarget: \(.target.address // "N/A")\nStatus: \(.current_session.status // "N/A")\nProfile: \(.profile_name // "N/A")\nProgress: \(.current_session.progress // 0)%\n---"
        '
        
        local count=$(echo "$response" | jq '.scans | length')
        echo -e "\n${GREEN}Total scans: $count${NC}"
    else
        echo -e "${RED}Error fetching scans${NC}"
        echo "$response" | jq . 2>/dev/null || echo "$response"
    fi
}

# Start a new scan
scans_start() {
    local target_id="$1"
    local profile="${2:-Full Scan}"
    
    if [[ -z "$target_id" ]]; then
        echo -e "${RED}Error: Target ID is required${NC}"
        echo "Usage: acunetix scans start <target_id> [profile]"
        echo ""
        echo "Available profiles:"
        echo "  - Full Scan (default)"
        echo "  - High Risk Vulnerabilities"
        echo "  - Cross-site Scripting Vulnerabilities"
        echo "  - SQL Injection Vulnerabilities"
        echo "  - Weak Passwords"
        echo "  - Crawl Only"
        exit 1
    fi
    
    print_header "Starting Scan"
    
    # Scan profile IDs
    local profile_id
    case "$profile" in
        "Full Scan"|"full")
            profile_id="11111111-1111-1111-1111-111111111111"
            ;;
        "High Risk"|"high")
            profile_id="11111111-1111-1111-1111-111111111112"
            ;;
        "XSS"|"xss")
            profile_id="11111111-1111-1111-1111-111111111116"
            ;;
        "SQL Injection"|"sqli")
            profile_id="11111111-1111-1111-1111-111111111113"
            ;;
        "Weak Passwords"|"passwords")
            profile_id="11111111-1111-1111-1111-111111111115"
            ;;
        "Crawl Only"|"crawl")
            profile_id="11111111-1111-1111-1111-111111111117"
            ;;
        *)
            profile_id="11111111-1111-1111-1111-111111111111"
            ;;
    esac
    
    local data=$(jq -n \
        --arg tid "$target_id" \
        --arg pid "$profile_id" \
        '{
            target_id: $tid,
            profile_id: $pid,
            schedule: {
                disable: false,
                start_date: null,
                time_sensitive: false
            }
        }')
    
    local response=$(api_request POST "/scans" "$data")
    
    if echo "$response" | jq -e '.scan_id' > /dev/null 2>&1; then
        local scan_id=$(echo "$response" | jq -r '.scan_id')
        echo -e "${GREEN}✓ Scan started successfully!${NC}"
        echo -e "Scan ID: ${YELLOW}$scan_id${NC}"
    else
        echo -e "${RED}Error starting scan${NC}"
        echo "$response" | jq . 2>/dev/null || echo "$response"
    fi
}

# Get scan status
scans_status() {
    local scan_id="$1"
    
    if [[ -z "$scan_id" ]]; then
        echo -e "${RED}Error: Scan ID is required${NC}"
        exit 1
    fi
    
    print_header "Scan Status"
    
    local response=$(api_request GET "/scans/$scan_id")
    
    if echo "$response" | jq -e '.current_session' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            "Scan ID: \(.scan_id)
Target: \(.target.address // "N/A")
Profile: \(.profile_name // "N/A")
Status: \(.current_session.status // "N/A")
Progress: \(.current_session.progress // 0)%
Severity Counts:
  - Critical: \(.current_session.severity_counts.critical // 0)
  - High: \(.current_session.severity_counts.high // 0)
  - Medium: \(.current_session.severity_counts.medium // 0)
  - Low: \(.current_session.severity_counts.low // 0)
  - Info: \(.current_session.severity_counts.info // 0)"
        '
    else
        echo "$response" | jq .
    fi
}

# Stop a scan
scans_stop() {
    local scan_id="$1"
    
    if [[ -z "$scan_id" ]]; then
        echo -e "${RED}Error: Scan ID is required${NC}"
        exit 1
    fi
    
    print_header "Stopping Scan"
    
    api_request POST "/scans/$scan_id/abort"
    echo -e "${GREEN}✓ Scan stopped!${NC}"
}

# Pause a scan
scans_pause() {
    local scan_id="$1"
    
    if [[ -z "$scan_id" ]]; then
        echo -e "${RED}Error: Scan ID is required${NC}"
        exit 1
    fi
    
    print_header "Pausing Scan"
    
    api_request POST "/scans/$scan_id/pause"
    echo -e "${GREEN}✓ Scan paused!${NC}"
}

# Resume a scan
scans_resume() {
    local scan_id="$1"
    
    if [[ -z "$scan_id" ]]; then
        echo -e "${RED}Error: Scan ID is required${NC}"
        exit 1
    fi
    
    print_header "Resuming Scan"
    
    api_request POST "/scans/$scan_id/resume"
    echo -e "${GREEN}✓ Scan resumed!${NC}"
}

# Delete a scan
scans_delete() {
    local scan_id="$1"
    
    if [[ -z "$scan_id" ]]; then
        echo -e "${RED}Error: Scan ID is required${NC}"
        exit 1
    fi
    
    print_header "Deleting Scan"
    
    api_request DELETE "/scans/$scan_id"
    echo -e "${GREEN}✓ Scan deleted!${NC}"
}

# ============== REPORTS ==============

# List all reports
reports_list() {
    print_header "Reports List"
    
    local response=$(api_request GET "/reports")
    
    if echo "$response" | jq -e '.reports' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            .reports[] | 
            "Report ID: \(.report_id)\nTemplate: \(.template_name // "N/A")\nStatus: \(.status // "N/A")\nGenerated: \(.generation_date // "N/A")\n---"
        '
        
        local count=$(echo "$response" | jq '.reports | length')
        echo -e "\n${GREEN}Total reports: $count${NC}"
    else
        echo -e "${RED}Error fetching reports${NC}"
        echo "$response" | jq . 2>/dev/null || echo "$response"
    fi
}

# Generate a report
reports_generate() {
    local scan_id="$1"
    local template="${2:-developer}"
    
    if [[ -z "$scan_id" ]]; then
        echo -e "${RED}Error: Scan ID is required${NC}"
        echo "Usage: acunetix reports generate <scan_id> [template]"
        echo ""
        echo "Available templates:"
        echo "  - developer (default) - Developer Report"
        echo "  - executive - Executive Summary"
        echo "  - quick - Quick Report"
        echo "  - affected - Affected Items"
        echo "  - compliance - Compliance Reports"
        echo "  - hipaa - HIPAA Report"
        echo "  - owasp-top-10-2017 - OWASP Top 10 2017"
        echo "  - owasp-top-10-2021 - OWASP Top 10 2021"
        echo "  - pci-dss-3.2 - PCI DSS 3.2"
        echo "  - sans-top-25 - SANS Top 25"
        echo "  - wasc - WASC Threat Classification"
        exit 1
    fi
    
    print_header "Generating Report"
    
    # Report template IDs
    local template_id
    case "$template" in
        "developer"|"dev")
            template_id="11111111-1111-1111-1111-111111111111"
            ;;
        "executive"|"exec")
            template_id="11111111-1111-1111-1111-111111111112"
            ;;
        "quick")
            template_id="11111111-1111-1111-1111-111111111113"
            ;;
        "affected")
            template_id="11111111-1111-1111-1111-111111111114"
            ;;
        "hipaa")
            template_id="11111111-1111-1111-1111-111111111115"
            ;;
        "owasp-top-10-2017"|"owasp2017")
            template_id="11111111-1111-1111-1111-111111111116"
            ;;
        "owasp-top-10-2021"|"owasp2021")
            template_id="11111111-1111-1111-1111-111111111119"
            ;;
        "pci-dss-3.2"|"pci")
            template_id="11111111-1111-1111-1111-111111111117"
            ;;
        "sans-top-25"|"sans")
            template_id="11111111-1111-1111-1111-111111111118"
            ;;
        *)
            template_id="11111111-1111-1111-1111-111111111111"
            ;;
    esac
    
    # First get the scan to find the result_id
    local scan_response=$(api_request GET "/scans/$scan_id")
    local result_id=$(echo "$scan_response" | jq -r '.current_session.scan_session_id // empty')
    
    if [[ -z "$result_id" ]]; then
        echo -e "${RED}Error: Could not get scan session ID${NC}"
        exit 1
    fi
    
    local data=$(jq -n \
        --arg tid "$template_id" \
        --arg source "/scans/$scan_id" \
        '{
            template_id: $tid,
            source: {
                list_type: "scans",
                id_list: [$source]
            }
        }')
    
    local response=$(api_request POST "/reports" "$data")
    
    if echo "$response" | jq -e '.report_id' > /dev/null 2>&1; then
        local report_id=$(echo "$response" | jq -r '.report_id')
        echo -e "${GREEN}✓ Report generation started!${NC}"
        echo -e "Report ID: ${YELLOW}$report_id${NC}"
    else
        echo -e "${RED}Error generating report${NC}"
        echo "$response" | jq . 2>/dev/null || echo "$response"
    fi
}

# Download a report
reports_download() {
    local report_id="$1"
    local output_file="${2:-report.pdf}"
    
    if [[ -z "$report_id" ]]; then
        echo -e "${RED}Error: Report ID is required${NC}"
        echo "Usage: acunetix reports download <report_id> [output_file]"
        exit 1
    fi
    
    print_header "Downloading Report"
    
    local url="${API_URL}/api/v1/reports/${report_id}/download"
    
    curl -s -k \
        -H "X-Auth: $API_KEY" \
        -o "$output_file" \
        "$url"
    
    if [[ -f "$output_file" ]]; then
        echo -e "${GREEN}✓ Report downloaded to: $output_file${NC}"
    else
        echo -e "${RED}Error downloading report${NC}"
    fi
}

# Delete a report
reports_delete() {
    local report_id="$1"
    
    if [[ -z "$report_id" ]]; then
        echo -e "${RED}Error: Report ID is required${NC}"
        exit 1
    fi
    
    print_header "Deleting Report"
    
    api_request DELETE "/reports/$report_id"
    echo -e "${GREEN}✓ Report deleted!${NC}"
}

# ============== VULNERABILITIES ==============

# List vulnerabilities for a scan
vulns_list() {
    local scan_id="$1"
    
    if [[ -z "$scan_id" ]]; then
        echo -e "${RED}Error: Scan ID is required${NC}"
        echo "Usage: acunetix vulns list <scan_id>"
        exit 1
    fi
    
    print_header "Vulnerabilities"
    
    local scan_response=$(api_request GET "/scans/$scan_id")
    local session_id=$(echo "$scan_response" | jq -r '.current_session.scan_session_id // empty')
    
    if [[ -z "$session_id" ]]; then
        echo -e "${RED}Error: Could not get scan session${NC}"
        exit 1
    fi
    
    local response=$(api_request GET "/scans/$scan_id/results/$session_id/vulnerabilities")
    
    if echo "$response" | jq -e '.vulnerabilities' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            .vulnerabilities[] |
            "[\(.severity | ascii_upcase)] \(.vt_name)
  Location: \(.affects_url // "N/A")
  Vuln ID: \(.vuln_id)
---"
        '
        
        local count=$(echo "$response" | jq '.vulnerabilities | length')
        echo -e "\n${GREEN}Total vulnerabilities: $count${NC}"
    else
        echo -e "${YELLOW}No vulnerabilities found or scan still in progress${NC}"
        echo "$response" | jq . 2>/dev/null || echo "$response"
    fi
}

# Get vulnerability details
vulns_info() {
    local scan_id="$1"
    local vuln_id="$2"
    
    if [[ -z "$scan_id" || -z "$vuln_id" ]]; then
        echo -e "${RED}Error: Scan ID and Vulnerability ID are required${NC}"
        echo "Usage: acunetix vulns info <scan_id> <vuln_id>"
        exit 1
    fi
    
    print_header "Vulnerability Details"
    
    local scan_response=$(api_request GET "/scans/$scan_id")
    local session_id=$(echo "$scan_response" | jq -r '.current_session.scan_session_id // empty')
    
    local response=$(api_request GET "/scans/$scan_id/results/$session_id/vulnerabilities/$vuln_id")
    echo "$response" | jq .
}

# ============== SCAN PROFILES ==============

# List scan profiles
profiles_list() {
    print_header "Scan Profiles"
    
    local response=$(api_request GET "/scanning_profiles")
    
    if echo "$response" | jq -e '.scanning_profiles' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            .scanning_profiles[] |
            "ID: \(.profile_id)
Name: \(.name)
---"
        '
    else
        echo "$response" | jq .
    fi
}

# ============== REPORT TEMPLATES ==============

# List report templates
templates_list() {
    print_header "Report Templates"
    
    local response=$(api_request GET "/report_templates")
    
    if echo "$response" | jq -e '.templates' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            .templates[] |
            "ID: \(.template_id)
Name: \(.name)
Group: \(.group // "N/A")
---"
        '
    else
        echo "$response" | jq .
    fi
}

# ============== INFO / STATUS ==============

# Get API info
info() {
    print_header "Acunetix Info"
    
    local response=$(api_request GET "/info")
    echo "$response" | jq .
}

# Get license info
license() {
    print_header "License Information"
    
    local response=$(api_request GET "/license")
    echo "$response" | jq .
}

# Dashboard stats
dashboard() {
    print_header "Dashboard"
    
    local response=$(api_request GET "/me/stats")
    echo "$response" | jq .
}

# ============== TARGET GROUPS ==============

# List target groups
groups_list() {
    print_header "Target Groups"
    
    local response=$(api_request GET "/target_groups")
    
    if echo "$response" | jq -e '.groups' > /dev/null 2>&1; then
        echo "$response" | jq -r '
            .groups[] |
            "ID: \(.group_id)
Name: \(.name)
Description: \(.description // "N/A")
---"
        '
    else
        echo "$response" | jq .
    fi
}

# ============== QUICK SCAN ==============

# Quick scan - add target and start scan immediately
quick_scan() {
    local address="$1"
    local profile="${2:-Full Scan}"
    
    if [[ -z "$address" ]]; then
        echo -e "${RED}Error: Target URL is required${NC}"
        echo "Usage: acunetix quick <url> [profile]"
        exit 1
    fi
    
    print_header "Quick Scan"
    
    echo -e "${BLUE}[1/2]${NC} Adding target: $address"
    
    local target_data=$(jq -n --arg addr "$address" '{address: $addr, criticality: 10}')
    local target_response=$(api_request POST "/targets" "$target_data")
    
    local target_id=$(echo "$target_response" | jq -r '.target_id // empty')
    
    if [[ -z "$target_id" ]]; then
        echo -e "${RED}Error adding target${NC}"
        echo "$target_response" | jq .
        exit 1
    fi
    
    echo -e "${GREEN}✓ Target added: $target_id${NC}"
    
    echo -e "${BLUE}[2/2]${NC} Starting scan..."
    
    # Get profile ID
    local profile_id
    case "$profile" in
        "Full Scan"|"full")
            profile_id="11111111-1111-1111-1111-111111111111"
            ;;
        "High Risk"|"high")
            profile_id="11111111-1111-1111-1111-111111111112"
            ;;
        *)
            profile_id="11111111-1111-1111-1111-111111111111"
            ;;
    esac
    
    local scan_data=$(jq -n \
        --arg tid "$target_id" \
        --arg pid "$profile_id" \
        '{target_id: $tid, profile_id: $pid, schedule: {disable: false, start_date: null, time_sensitive: false}}')
    
    local scan_response=$(api_request POST "/scans" "$scan_data")
    local scan_id=$(echo "$scan_response" | jq -r '.scan_id // empty')
    
    if [[ -n "$scan_id" ]]; then
        echo -e "${GREEN}✓ Scan started!${NC}"
        echo -e "\nTarget ID: ${YELLOW}$target_id${NC}"
        echo -e "Scan ID: ${YELLOW}$scan_id${NC}"
        echo -e "\nUse '${CYAN}acunetix scans status $scan_id${NC}' to check progress"
    else
        echo -e "${RED}Error starting scan${NC}"
        echo "$scan_response" | jq .
    fi
}

# ============== HELP ==============

show_help() {
    echo -e "${CYAN}
    ___               ___    ____  ____
   /   | _______  __ /   |  / __ \/  _/
  / /| |/ ___/ / / // /| | / /_/ // /  
 / ___ / /__/ /_/ // ___ |/ ____// /   
/_/  |_\___/\__,_//_/  |_/_/   /___/   
                                        
${NC}"
    echo -e "${BLUE}Acunetix CLI - Command Line Interface${NC}"
    echo -e "${YELLOW}Version 1.0.0${NC}\n"
    
    echo -e "${GREEN}USAGE:${NC}"
    echo "  acunetix <command> <subcommand> [options]"
    echo ""
    
    echo -e "${GREEN}COMMANDS:${NC}"
    echo ""
    
    echo -e "  ${YELLOW}targets${NC}         Manage scan targets"
    echo "    list                      List all targets"
    echo "    add <url> [desc] [crit]   Add a new target"
    echo "    info <target_id>          Get target details"
    echo "    delete <target_id>        Delete a target"
    echo ""
    
    echo -e "  ${YELLOW}scans${NC}           Manage scans"
    echo "    list                      List all scans"
    echo "    start <target_id> [prof]  Start a new scan"
    echo "    status <scan_id>          Get scan status"
    echo "    stop <scan_id>            Stop/abort a scan"
    echo "    pause <scan_id>           Pause a scan"
    echo "    resume <scan_id>          Resume a paused scan"
    echo "    delete <scan_id>          Delete a scan"
    echo ""
    
    echo -e "  ${YELLOW}reports${NC}         Manage reports"
    echo "    list                      List all reports"
    echo "    generate <scan_id> [tmpl] Generate a report"
    echo "    download <report_id> [f]  Download report to file"
    echo "    delete <report_id>        Delete a report"
    echo ""
    
    echo -e "  ${YELLOW}vulns${NC}           View vulnerabilities"
    echo "    list <scan_id>            List vulnerabilities"
    echo "    info <scan_id> <vuln_id>  Get vulnerability details"
    echo ""
    
    echo -e "  ${YELLOW}profiles${NC}        List scan profiles"
    echo "    list                      List available profiles"
    echo ""
    
    echo -e "  ${YELLOW}templates${NC}       List report templates"
    echo "    list                      List available templates"
    echo ""
    
    echo -e "  ${YELLOW}groups${NC}          Target groups"
    echo "    list                      List target groups"
    echo ""
    
    echo -e "  ${YELLOW}quick${NC}           Quick scan"
    echo "    <url> [profile]           Add target and start scan"
    echo ""
    
    echo -e "  ${YELLOW}info${NC}            API information"
    echo "  ${YELLOW}license${NC}         License information"
    echo "  ${YELLOW}dashboard${NC}       Dashboard statistics"
    echo ""
    
    echo -e "${GREEN}SCAN PROFILES:${NC}"
    echo "  full, high, xss, sqli, passwords, crawl"
    echo ""
    
    echo -e "${GREEN}REPORT TEMPLATES:${NC}"
    echo "  developer, executive, quick, affected, hipaa,"
    echo "  owasp2017, owasp2021, pci, sans"
    echo ""
    
    echo -e "${GREEN}EXAMPLES:${NC}"
    echo "  acunetix targets list"
    echo "  acunetix targets add https://example.com \"My Site\" 10"
    echo "  acunetix scans start abc-123-def full"
    echo "  acunetix scans status abc-456-ghi"
    echo "  acunetix quick https://example.com"
    echo "  acunetix reports generate abc-456 developer"
    echo "  acunetix reports download xyz-789 report.pdf"
    echo ""
}

# ============== MAIN ==============

main() {
    load_config
    
    local command="${1:-help}"
    local subcommand="${2:-}"
    
    case "$command" in
        targets)
            case "$subcommand" in
                list|ls)    targets_list ;;
                add)        targets_add "$3" "$4" "$5" ;;
                info|get)   targets_info "$3" ;;
                delete|rm)  targets_delete "$3" ;;
                *)          echo "Usage: acunetix targets <list|add|info|delete>" ;;
            esac
            ;;
        scans)
            case "$subcommand" in
                list|ls)    scans_list ;;
                start)      scans_start "$3" "$4" ;;
                status)     scans_status "$3" ;;
                stop|abort) scans_stop "$3" ;;
                pause)      scans_pause "$3" ;;
                resume)     scans_resume "$3" ;;
                delete|rm)  scans_delete "$3" ;;
                *)          echo "Usage: acunetix scans <list|start|status|stop|pause|resume|delete>" ;;
            esac
            ;;
        reports)
            case "$subcommand" in
                list|ls)    reports_list ;;
                generate)   reports_generate "$3" "$4" ;;
                download)   reports_download "$3" "$4" ;;
                delete|rm)  reports_delete "$3" ;;
                *)          echo "Usage: acunetix reports <list|generate|download|delete>" ;;
            esac
            ;;
        vulns|vulnerabilities)
            case "$subcommand" in
                list|ls)    vulns_list "$3" ;;
                info|get)   vulns_info "$3" "$4" ;;
                *)          echo "Usage: acunetix vulns <list|info>" ;;
            esac
            ;;
        profiles)
            profiles_list
            ;;
        templates)
            templates_list
            ;;
        groups)
            case "$subcommand" in
                list|ls)    groups_list ;;
                *)          groups_list ;;
            esac
            ;;
        quick)
            quick_scan "$2" "$3"
            ;;
        info)
            info
            ;;
        license)
            license
            ;;
        dashboard|stats)
            dashboard
            ;;
        help|--help|-h)
            show_help
            ;;
        *)
            show_help
            ;;
    esac
}

main "$@"
